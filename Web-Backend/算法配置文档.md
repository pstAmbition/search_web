# 虚假信息检测算法后端配置文档

## 📋 概述

本文档详细说明了虚假信息检测系统的后端配置，包括5个算法模块的虚拟环境配置、大文件下载说明以及服务启动停止方法。

## 🗂️ 算法模块说明

系统包含以下5个检测算法：

1. **文本谣言检测** (`text_detection`) - 检测文本内容的真实性
2. **图像伪造检测** (`image_detection`) - 检测图像是否被伪造
3. **音视频伪造检测** (`audio_video_detection`) - 检测音视频内容的真实性
4. **实体识别** (`entity_identification`) - 识别文本中的实体信息
5. **多模态假信息检测** (`multimodal_detection`) - 综合文本和图像进行检测

## 📦 大文件下载说明

由于GitHub对单个文件大小有限制（100MB），以下大文件需要通过百度网盘下载并放置到指定目录：

### 🔴 需要下载的大文件列表

#### 1. 文本谣言检测模块
```
📁 文件路径: /Web-Backend/algorithms/text_detection/chinese-roberta-wwm-ext/
📊 总大小: 1.2GB
📋 包含文件:
   - pytorch_model.bin (393MB)
   - tf_model.h5 (391MB)
   - flax_model.msgpack (391MB)
   - config.json
   - tokenizer.json
   - vocab.txt
   - 其他配置文件

📁 文件路径: /Web-Backend/algorithms/text_detection/model/
📊 总大小: 391MB
📋 包含文件:
   - best-model.bin (391MB)
```

#### 2. 图像伪造检测模块
```
📁 文件路径: /Web-Backend/algorithms/image_detection/ImageFornsicsOSN/weights/
📊 总大小: 493MB
📋 包含文件:
   - detector_weights.pth (493MB)
```

#### 3. 音视频伪造检测模块
```
📁 文件路径: /Web-Backend/algorithms/audio_video_detection/models/
📊 总大小: 361MB
📋 包含文件:
   - Deepfake-audio-detection/model.safetensors (361MB)
   - Deepfake-audio-detection/training_args.bin (4.9KB)
   - FaceForensics/classification/models/models_subset/full/xception/full_raw.pth (80MB)
```

#### 4. 实体识别模块
```
📁 文件路径: /Web-Backend/algorithms/entity_identification/bert-base-chinese/
📊 总大小: 393MB
📋 包含文件:
   - pytorch_model.bin (393MB)
   - config.json
   - tokenizer.json
   - vocab.txt
   - 其他配置文件

📁 文件路径: /Web-Backend/algorithms/entity_identification/saved_model-tagger-context/
📊 总大小: 406MB
�� 包含文件:
   - bert-base-chinese_10.pth (406MB)
```

#### 5. 多模态假信息检测模块
```
📁 文件路径: /Web-Backend/algorithms/multimodal_detection/test_api/models/bert-base-uncased/
📊 总大小: 421MB
📋 包含文件:
   - pytorch_model.bin (421MB)
   - config.json
   - tokenizer.json
   - vocab.txt
   - 其他配置文件

📁 文件路径: /Web-Backend/algorithms/multimodal_detection/test_api/
📊 总大小: 3.9MB
📋 包含文件:
   - detection_module.pt (2.5MB)
   - similarity_module.pt (1.4MB)
```

### 📥 下载和放置步骤

**🔗 百度网盘下载链接**
- **虚假信息检测算法** 
- 链接: https://pan.baidu.com/s/1TtCq0jE30N22Y7AmGBp4ig?pwd=jxy2 
- 提取码: jxy2

**📋 下载说明**
- 所有模型文件已打包上传至百度网盘
- 总计约3GB的模型权重文件
- 包含5个算法模块的所有必需模型文件

### 📥 下载和放置步骤

1. **下载压缩包**: 从百度网盘下载所有大文件的压缩包
2. **解压文件**: 将压缩包解压到临时目录
3. **放置文件**: 按照上述路径结构将文件放置到对应目录
4. **验证文件**: 确保所有文件大小和路径正确

## 🐍 虚拟环境配置

### 环境要求
- Python 3.8+
- Conda 或 Miniconda
- CUDA 11.0+ (推荐，用于GPU加速)

### 快速安装步骤

每个算法模块都提供了自动安装脚本，只需按以下步骤操作：

#### 1. 创建虚拟环境
```bash
# 为每个算法创建独立的虚拟环境
conda create -n text_detection python=3.8 -y
conda create -n image_detection python=3.8 -y
conda create -n audio_video_detection python=3.8 -y
conda create -n entity_identification python=3.8 -y
conda create -n multimodal_detection python=3.8 -y
```

#### 2. 激活环境并运行安装脚本
```bash
# 文本谣言检测
conda activate text_detection
cd Web-Backend/algorithms/text_detection
bash install_step_by_step.sh

# 图像伪造检测
conda activate image_detection
cd Web-Backend/algorithms/image_detection
bash install_step_by_step.sh

# 音视频伪造检测
conda activate audio_video_detection
cd Web-Backend/algorithms/audio_video_detection
bash install_step_by_step.sh

# 实体识别
conda activate entity_identification
cd Web-Backend/algorithms/entity_identification
bash install_step_by_step.sh

# 多模态假信息检测
conda activate multimodal_detection
cd Web-Backend/algorithms/multimodal_detection/test_api
bash install_step_by_step.sh
```

#### 3. 验证安装
每个安装脚本都会自动验证关键依赖是否正确安装。

**注意**: 安装脚本基于各算法的Dockerfile和requirements.txt配置，确保环境一致性。

## 🚀 服务启动和管理

### 启动所有服务

```bash
# 进入项目目录
cd /path/to/search_web/Web-Backend

# 启动所有算法服务
bash scripts/start_all_algorithms.sh
```

### 检查服务状态

```bash
# 检查所有服务状态
bash scripts/check_services.sh
```

### 停止所有服务

```bash
# 停止所有算法服务
bash scripts/stop_all_algorithms.sh
```

### 服务端口说明

| 算法模块 | 端口 | 健康检查端点 |
|---------|------|-------------|
| 文本谣言检测 | 5013 | http://localhost:5013/health |
| 图像伪造检测 | 5014 | http://localhost:5014/health |
| 音视频伪造检测 | 5015 | http://localhost:5015/health |
| 实体识别 | 5016 | http://localhost:5016/health |
| 多模态假信息检测 | 5017 | http://localhost:5017/health |

## 📝 日志管理

### 查看实时日志

```bash
# 查看所有服务日志
tail -f logs/*.log

# 查看特定服务日志
tail -f logs/text_detection.log
tail -f logs/image_detection.log
tail -f logs/audio_video_detection.log
tail -f logs/entity_identification.log
tail -f logs/multimodal_detection.log
```

### 日志文件位置

```
Web-Backend/logs/
├── text_detection.log
├── image_detection.log
├── audio_video_detection.log
├── entity_identification.log
└── multimodal_detection.log
```

## 🔧 故障排除

### 常见问题

1. **端口被占用**
   ```bash
   # 查看端口占用
   netstat -tlnp | grep :5013
   
   # 杀死占用进程
   pkill -f "python.*build_api.py"
   ```

2. **虚拟环境激活失败**
   ```bash
   # 初始化conda
   source /path/to/anaconda3/etc/profile.d/conda.sh
   
   # 重新激活环境
   conda activate text_detection
   ```

3. **模型文件缺失**
   - 检查大文件是否正确下载和放置
   - 验证文件路径和权限
   - 确认文件大小正确

4. **GPU内存不足**
   ```bash
   # 查看GPU使用情况
   nvidia-smi
   
   # 如果内存不足，可以修改代码使用CPU
   # 在build_api.py中添加: device = 'cpu'
   ```

### 健康检查

```bash
# 检查所有服务健康状态
curl http://localhost:5013/health
curl http://localhost:5014/health
curl http://localhost:5015/health
curl http://localhost:5016/health
curl http://localhost:5017/health
```

## 📊 性能优化建议

1. **GPU加速**: 确保CUDA环境正确配置
2. **内存管理**: 根据服务器内存调整模型加载策略
3. **并发处理**: 根据CPU核心数调整Flask线程数
4. **缓存策略**: 对频繁使用的模型进行内存缓存

## 🔄 更新和维护

1. **定期检查日志**: 监控服务运行状态
2. **备份模型文件**: 定期备份重要的模型权重
3. **更新依赖**: 定期更新Python包版本
4. **性能监控**: 监控服务响应时间和资源使用情况

---

## 📞 技术支持

如有问题，请检查：
1. 日志文件中的错误信息
2. 虚拟环境是否正确激活
3. 模型文件是否完整
4. 网络连接是否正常

**注意**: 确保所有大文件都已正确下载并放置到指定目录，否则服务将无法正常启动。


## 📋 安装脚本说明

每个算法模块都包含一个 `install_step_by_step.sh` 脚本，该脚本：

### 脚本特点
- **自动化安装**: 基于requirements.txt或install_step_by_step.sh配置
- **版本控制**: 使用经过测试的特定版本组合
- **错误处理**: 包含错误检查和回滚机制
- **环境验证**: 自动验证关键依赖安装状态

### 脚本内容
- 系统依赖检查和安装
- PyTorch版本清理和重新安装
- 算法特定依赖安装
- 模型文件验证
- 环境测试和验证

### 使用建议
1. **按顺序执行**: 建议按照文档中的顺序依次安装
2. **网络环境**: 确保网络连接稳定，某些包需要从外网下载
3. **权限要求**: 部分系统依赖可能需要sudo权限
4. **存储空间**: 确保有足够的磁盘空间（每个环境约2-3GB）

