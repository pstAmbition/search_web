<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API配置测试</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 8px 16px; margin-right: 10px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <div class="container">
        <h1>API配置测试页面</h1>
        
        <div class="section">
            <h2>测试1: 相对路径请求 (模拟前端配置)</h2>
            <button onclick="testRelativePath()">发起请求</button>
            <div id="relativePathResult"></div>
        </div>
        
        <div class="section">
            <h2>测试2: 直接请求后端 (5000端口)</h2>
            <button onclick="testDirectBackend()">发起请求</button>
            <div id="directBackendResult"></div>
        </div>
        
        <div class="section">
            <h2>测试3: 检查代理配置</h2>
            <button onclick="checkProxyConfig()">检查配置</button>
            <div id="proxyConfigResult"></div>
        </div>
        
        <div class="section">
            <h2>环境信息</h2>
            <p>当前页面URL: <span id="currentUrl"></span></p>
            <p>浏览器: <span id="browserInfo"></span></p>
        </div>
    </div>

    <script>
        // 显示当前页面URL和浏览器信息
        document.getElementById('currentUrl').textContent = window.location.href;
        document.getElementById('browserInfo').textContent = navigator.userAgent;
        
        // 创建axios实例，模拟前端配置
        const apiClient = axios.create({
            baseURL: '/api',
            timeout: 20000,
            withCredentials: true
        });
        
        // 添加请求拦截器，记录请求信息
        apiClient.interceptors.request.use(
            config => {
                console.log('请求配置:', config);
                return config;
            },
            error => {
                return Promise.reject(error);
            }
        );
        
        // 添加响应拦截器，记录响应信息
        apiClient.interceptors.response.use(
            response => {
                console.log('响应数据:', response);
                return response;
            },
            error => {
                console.error('请求错误:', error);
                return Promise.reject(error);
            }
        );
        
        // 测试1: 使用相对路径发起请求
        function testRelativePath() {
            const resultElement = document.getElementById('relativePathResult');
            resultElement.innerHTML = '<p>发起请求中...</p>';
            
            const startTime = Date.now();
            
            apiClient.get('/getAllEvents', {
                params: { page: 1, page_size: 5 }
            })
            .then(response => {
                const endTime = Date.now();
                resultElement.innerHTML = `
                    <p class="success">请求成功！耗时: ${endTime - startTime}ms</p>
                    <p>状态码: ${response.status}</p>
                    <p>响应数据:</p>
                    <pre>${JSON.stringify(response.data, null, 2)}</pre>
                `;
            })
            .catch(error => {
                const endTime = Date.now();
                resultElement.innerHTML = `
                    <p class="error">请求失败！耗时: ${endTime - startTime}ms</p>
                    <p>错误信息: ${error.message}</p>
                    ${error.response ? `
                        <p>状态码: ${error.response.status}</p>
                        <pre>${JSON.stringify(error.response.data, null, 2)}</pre>
                    ` : ''}
                    <pre>完整错误: ${JSON.stringify(error, null, 2)}</pre>
                `;
            });
        }
        
        // 测试2: 直接请求后端5000端口
        function testDirectBackend() {
            const resultElement = document.getElementById('directBackendResult');
            resultElement.innerHTML = '<p>发起请求中...</p>';
            
            const startTime = Date.now();
            
            axios.get('http://localhost:5000/api/getAllEvents', {
                params: { page: 1, page_size: 5 },
                withCredentials: true
            })
            .then(response => {
                const endTime = Date.now();
                resultElement.innerHTML = `
                    <p class="success">请求成功！耗时: ${endTime - startTime}ms</p>
                    <p>状态码: ${response.status}</p>
                    <p>响应数据:</p>
                    <pre>${JSON.stringify(response.data, null, 2)}</pre>
                `;
            })
            .catch(error => {
                const endTime = Date.now();
                resultElement.innerHTML = `
                    <p class="error">请求失败！耗时: ${endTime - startTime}ms</p>
                    <p>错误信息: ${error.message}</p>
                    ${error.response ? `
                        <p>状态码: ${error.response.status}</p>
                        <pre>${JSON.stringify(error.response.data, null, 2)}</pre>
                    ` : ''}
                `;
            });
        }
        
        // 测试3: 检查代理配置（通过前端接口）
        function checkProxyConfig() {
            const resultElement = document.getElementById('proxyConfigResult');
            resultElement.innerHTML = '<p>检查中...</p>';
            
            // 这里我们只能检查前端的配置，无法直接获取vue.config.js的内容
            // 所以我们会显示前端axios的配置和尝试一些测试请求来间接验证代理
            
            // 显示axios配置
            resultElement.innerHTML = `
                <p>前端axios配置:</p>
                <pre>baseURL: ${apiClient.defaults.baseURL}</pre>
                <pre>timeout: ${apiClient.defaults.timeout}</pre>
                <pre>withCredentials: ${apiClient.defaults.withCredentials}</pre>
                <p>请尝试上面的请求测试，以验证代理是否正常工作</p>
            `;
        }
    </script>
</body>
</html>